{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es.string.includes.js","webpack:///./src/views/User/Chat.vue?8a94","webpack:///./node_modules/core-js/internals/not-a-regexp.js","webpack:///./node_modules/core-js/internals/correct-is-regexp-logic.js","webpack:///./src/views/User/Chat.vue?cca8","webpack:///./src/models/TicketMessage.ts","webpack:///./src/models/Ticket.ts","webpack:///./src/views/User/Chat.vue","webpack:///./src/views/User/Chat.vue?cb14","webpack:///./src/views/User/Chat.vue?d937","webpack:///./node_modules/core-js/modules/es.array.includes.js"],"names":["$","notARegExp","requireObjectCoercible","correctIsRegExpLogic","target","proto","forced","includes","searchString","String","this","indexOf","arguments","length","undefined","isRegExp","module","exports","it","TypeError","wellKnownSymbol","MATCH","METHOD_NAME","regexp","error1","error2","render","_vm","_h","$createElement","_c","_self","staticClass","messages","ref","_l","message","key","id","_v","_s","author","attrs","created_at","domProps","getValidationMessage","$v","formData","class","$error","customToolbar","on","$event","$touch","model","value","callback","$$v","$set","trim","expression","onSendMessage","disableCheckBtn","onChecked","name","staticRenderFns","params","http","get","post","TicketMessage","prepareFormData","BaseModel","Ticket","STATE_NEW","STATE_OPEN","STATE_WAITING","STATE_CLOSED","ticket","status","window","scrollTo","top","innerHeight","behavior","getList","ticket_user_id","Number","$route","sortType","sortField","then","res","data","$reset","$nextTick","scroll","user_id","update","$router","push","$invalid","$store","setData","title","variant","direction","create","updateState","components","VueEditor","validations","required","header","align","list","indent","color","background","component","$includes","addToUnscopables","el"],"mappings":"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","file":"js/chunk-1c55e8a0.444fd9db.js","sourcesContent":["'use strict';\nvar $ = require('../internals/export');\nvar notARegExp = require('../internals/not-a-regexp');\nvar requireObjectCoercible = require('../internals/require-object-coercible');\nvar correctIsRegExpLogic = require('../internals/correct-is-regexp-logic');\n\n// `String.prototype.includes` method\n// https://tc39.es/ecma262/#sec-string.prototype.includes\n$({ target: 'String', proto: true, forced: !correctIsRegExpLogic('includes') }, {\n  includes: function includes(searchString /* , position = 0 */) {\n    return !!~String(requireObjectCoercible(this))\n      .indexOf(notARegExp(searchString), arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/stylus-loader/index.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=style&index=0&id=2bbf4d94&scoped=true&lang=stylus&\"","var isRegExp = require('../internals/is-regexp');\n\nmodule.exports = function (it) {\n  if (isRegExp(it)) {\n    throw TypeError(\"The method doesn't accept regular expressions\");\n  } return it;\n};\n","var wellKnownSymbol = require('../internals/well-known-symbol');\n\nvar MATCH = wellKnownSymbol('match');\n\nmodule.exports = function (METHOD_NAME) {\n  var regexp = /./;\n  try {\n    '/./'[METHOD_NAME](regexp);\n  } catch (error1) {\n    try {\n      regexp[MATCH] = false;\n      return '/./'[METHOD_NAME](regexp);\n    } catch (error2) { /* empty */ }\n  } return false;\n};\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"mx-auto chat\"},[_c('b-card',{staticClass:\"mt-3 shadow-sm\"},[(_vm.messages.length)?_c('PerfectScrollbar',{ref:\"ps\",staticClass:\"ps\"},[_c('b-list-group',{ref:\"message-container\"},_vm._l((_vm.messages),function(message){return _c('b-list-group-item',{key:message.id},[_c('b-media',[_c('div',{staticClass:\"d-flex justify-content-between align-items-start\"},[_c('h5',{staticClass:\"mt-0\"},[_vm._v(_vm._s(message.author))]),_c('b-badge',{attrs:{\"variant\":\"primary\",\"pill\":\"\"}},[_vm._v(_vm._s(message.created_at))])],1),_c('p',{domProps:{\"innerHTML\":_vm._s(message.message)}})])],1)}),1)],1):_c('p',[_vm._v(\"С этим пользователем у вас пока нет сообщений\")])],1),_c('b-card',{ref:\"text-editor-container\",staticClass:\"mt-3 shadow-sm\"},[_c('b-form-group',{attrs:{\"label\":\"Сообщеие\",\"label-for\":\"description\",\"invalid-feedback\":_vm.getValidationMessage(_vm.$v.formData.message)}},[_c('vue-editor',{ref:\"text-editor\",staticClass:\"text-editor\",class:{ 'is-invalid': _vm.$v.formData.message.$error },attrs:{\"id\":\"textarea\",\"editor-toolbar\":_vm.customToolbar},on:{\"input\":function($event){return _vm.$v.formData.message.$touch()}},model:{value:(_vm.formData.message),callback:function ($$v) {_vm.$set(_vm.formData, \"message\", (typeof $$v === 'string'? $$v.trim(): $$v))},expression:\"formData.message\"}})],1),_c('b-button',{staticClass:\"mr-1\",attrs:{\"variant\":\"primary\"},on:{\"click\":_vm.onSendMessage}},[_vm._v(\" Отправить \")]),_c('b-button',{staticClass:\"mr-2\",attrs:{\"variant\":\"success\",\"disabled\":_vm.disableCheckBtn},on:{\"click\":_vm.onChecked}},[_vm._v(\" Просмотрено \")]),_c('b-button',{attrs:{\"variant\":\"secondary\",\"to\":{ name: 'admin.user' }}},[_vm._v(\" Назад \")])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import BaseModel from \"@/models/BaseModel\";\nimport {AxiosResponse} from \"axios\";\nimport http from \"@/common/http\";\nimport api from \"@/common/myApi.json\";\n\nexport default class TicketMessage extends BaseModel {\n    message!: string\n    author!: string\n    ticket_id!: number\n\n    static getList(params: { ticket_user_id: number, [key: string]: any }): Promise<AxiosResponse<Array<TicketMessage>>> {\n        if (process.env.VUE_APP_USE_LOCAL_API === 'false') {\n            return http.get<Array<TicketMessage>>(`auth/ticket-message`, { params })\n        } else {\n            return new Promise<AxiosResponse<Array<TicketMessage>>>((resolve) => {\n                resolve({ data: api.User }as AxiosResponse<Array<TicketMessage>>)\n            })\n        }\n\n    }\n\n    static create (params: { ticket_user_id: number, message: string, [key: string]: any }): Promise<AxiosResponse<TicketMessage>> {\n        return http.post<TicketMessage>('auth/ticket-message', TicketMessage.prepareFormData(params))\n    }\n}","import BaseModel from \"@/models/BaseModel\";\nimport {AxiosResponse} from \"axios\";\nimport http from \"@/common/http\";\n\n\nexport default class Ticket extends BaseModel {\n  message!: string\n  author!: string\n  status!: number\n\n  static STATE_NEW = 0\n  static STATE_OPEN = 1\n  static STATE_WAITING = 2\n  static STATE_CLOSED = 3\n\n  static get(params: { [key: string]: string | number }): Promise<AxiosResponse<Ticket>> {\n    return http.get<Ticket>('ticket', { params: params })\n  }\n\n  static create (params: { ticket_user_id: number, message: string, [key: string]: any }): Promise<AxiosResponse<Ticket>> {\n    return http.post<Ticket>('ticket', Ticket.prepareFormData(params))\n  }\n\n  static update (params: { [key: string]: any }): Promise<AxiosResponse<Ticket>> {\n    return http.post<Ticket>('ticket/' + params.id, Ticket.prepareFormData({...params, \"_method\": \"PUT\"}))\n  }\n}","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport {Component, Mixins, Ref, Vue} from \"vue-property-decorator\";\nimport TicketMessage from \"@/models/TicketMessage\";\n// @ts-ignore\nimport {VueEditor} from 'vue2-editor'\nimport {getModule} from \"vuex-module-decorators\";\nimport Notification from \"@/store/modules/notification\";\nimport {Validation, validationMixin} from \"vuelidate\";\nimport ValidationMixin from \"@/mixins/validation\";\nimport {required} from \"vuelidate/lib/validators\";\nimport $ from 'jquery'\nimport Ticket from \"@/models/Ticket\";\n\n\n@Component({\n  components: {VueEditor},\n  validations: {\n    formData: {\n      message: {\n        required\n      }\n    },\n  },\n  data: () => ({\n    customToolbar: [[{\n      header: [false, 2, 3, 4, 5, 6]\n    }], [\"bold\", \"italic\", \"underline\", \"strike\"],\n      [{\n        align: \"\"\n      }, {\n        align: \"center\"\n      }, {\n        align: \"right\"\n      }, {\n        align: \"justify\"\n      }], [\"blockquote\", \"code-block\"], [{\n        list: \"ordered\"\n      }, {\n        list: \"bullet\"\n      }, {\n        list: \"check\"\n      }], [{\n        indent: \"-1\"\n      }, {\n        indent: \"+1\"\n      }],\n      [{\n        color: []\n      }, {\n        background: []\n      }],\n      [\"link\"], [\"clean\"]\n    ]\n\n  })\n})\nexport default class Chat extends Mixins<Validation, ValidationMixin>(validationMixin, ValidationMixin) {\n  @Ref('ps') $refPs!: Vue\n  @Ref('message-container') $refMessageContainer!: HTMLElement\n  @Ref('text-editor') $refTextEditor!: Vue\n  messages = [] as Array<TicketMessage>\n  ticket = null as Ticket | null\n  formData = {\n    message: ''\n  }\n\n  get disableCheckBtn(): boolean {\n    return [Ticket.STATE_OPEN, Ticket.STATE_CLOSED].includes(this.ticket?.status as number) || !this.messages.length\n  }\n\n  scroll(): void {\n    window.scrollTo({\n      top: window.innerHeight,\n      behavior: 'smooth'\n    })\n  }\n  updateState(): void {\n    this.formData.message = ''\n\n    TicketMessage.getList({ ticket_user_id: Number(this.$route.params.id), sortType: 'desc', sortField: 'created_at' })\n        .then(res => {\n          this.messages = res.data\n          this.$v.$reset()\n          this.$nextTick(() => this.scroll())\n        })\n\n    Ticket.get({ user_id: Number(this.$route.params.id) }).then(res => {\n      this.ticket = res.data\n    })\n  }\n\n  onChecked(): void {\n    Ticket.update({\n      id: this.ticket?.id as number,\n      status: Ticket.STATE_OPEN\n    }).then(() => {\n      this.$router.push({ name: 'admin.user' })\n    })\n  }\n  onSendMessage(): void {\n    this.$v.$touch()\n\n    if (!this.$v.$invalid) {\n      TicketMessage.create({ ticket_user_id: Number(this.$route.params.id), ...this.formData }).then(() => {\n        getModule(Notification, this.$store).setData({title: 'Сообщение успешно отправлено', variant: 'success', direction: 1 })\n        this.updateState()\n      })\n    } else {\n      getModule(Notification, this.$store).setData({title: 'Заполните сообщение', variant: 'danger', direction: 1 })\n    }\n  }\n\n  mounted(): void {\n    this.updateState()\n  }\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Chat.vue?vue&type=template&id=2bbf4d94&scoped=true&\"\nimport script from \"./Chat.vue?vue&type=script&lang=ts&\"\nexport * from \"./Chat.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Chat.vue?vue&type=style&index=0&id=2bbf4d94&scoped=true&lang=stylus&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2bbf4d94\",\n  null\n  \n)\n\nexport default component.exports","'use strict';\nvar $ = require('../internals/export');\nvar $includes = require('../internals/array-includes').includes;\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// `Array.prototype.includes` method\n// https://tc39.es/ecma262/#sec-array.prototype.includes\n$({ target: 'Array', proto: true }, {\n  includes: function includes(el /* , fromIndex = 0 */) {\n    return $includes(this, el, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('includes');\n"],"sourceRoot":""}