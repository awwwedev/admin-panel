(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1c55e8a0"],{2532:function(t,e,a){"use strict";var r=a("23e7"),i=a("5a34"),s=a("1d80"),n=a("ab13");r({target:"String",proto:!0,forced:!n("includes")},{includes:function(t){return!!~String(s(this)).indexOf(i(t),arguments.length>1?arguments[1]:void 0)}})},"4e88":function(t,e,a){"use strict";a("9f89")},"5a34":function(t,e,a){var r=a("44e7");t.exports=function(t){if(r(t))throw TypeError("The method doesn't accept regular expressions");return t}},"9f89":function(t,e,a){},ab13:function(t,e,a){var r=a("b622"),i=r("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(a){try{return e[i]=!1,"/./"[t](e)}catch(r){}}return!1}},ca5d:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mx-auto chat"},[a("b-card",{staticClass:"mt-3 shadow-sm"},[t.messages.length?a("PerfectScrollbar",{ref:"ps",staticClass:"ps"},[a("b-list-group",{ref:"message-container"},t._l(t.messages,(function(e){return a("b-list-group-item",{key:e.id},[a("b-media",[a("div",{staticClass:"d-flex justify-content-between align-items-start"},[a("h5",{staticClass:"mt-0"},[t._v(t._s(e.author))]),a("b-badge",{attrs:{variant:"primary",pill:""}},[t._v(t._s(e.created_at))])],1),a("p",{domProps:{innerHTML:t._s(e.message)}})])],1)})),1)],1):a("p",[t._v("С этим пользователем у вас пока нет сообщений")])],1),a("b-card",{ref:"text-editor-container",staticClass:"mt-3 shadow-sm"},[a("b-form-group",{attrs:{label:"Сообщеие","label-for":"description","invalid-feedback":t.getValidationMessage(t.$v.formData.message)}},[a("vue-editor",{ref:"text-editor",staticClass:"text-editor",class:{"is-invalid":t.$v.formData.message.$error},attrs:{id:"textarea","editor-toolbar":t.customToolbar},on:{input:function(e){return t.$v.formData.message.$touch()}},model:{value:t.formData.message,callback:function(e){t.$set(t.formData,"message","string"===typeof e?e.trim():e)},expression:"formData.message"}})],1),a("b-button",{staticClass:"mr-1",attrs:{variant:"primary"},on:{click:t.onSendMessage}},[t._v(" Отправить ")]),a("b-button",{staticClass:"mr-2",attrs:{variant:"success",disabled:t.disableCheckBtn},on:{click:t.onChecked}},[t._v(" Просмотрено ")]),a("b-button",{attrs:{variant:"secondary",to:{name:"admin.user"}}},[t._v(" Назад ")])],1)],1)},i=[],s=a("5530"),n=a("d4ec"),c=a("bee2"),o=a("262e"),u=a("2caf"),d=(a("caad"),a("2532"),a("a9e3"),a("9ab4")),l=a("1b40"),b=(a("d3b7"),a("72df")),f=a("c873"),m=(a("3949"),function(t){Object(o["a"])(a,t);var e=Object(u["a"])(a);function a(){return Object(n["a"])(this,a),e.apply(this,arguments)}return Object(c["a"])(a,null,[{key:"getList",value:function(t){return f["a"].get("auth/ticket-message",{params:t})}},{key:"create",value:function(t){return f["a"].post("auth/ticket-message",a.prepareFormData(t))}}]),a}(b["a"])),p=a("5873"),v=a("6fc5"),h=a("37c5"),g=a("1dce"),k=a("c67c"),O=a("b5ae"),j=function(t){Object(o["a"])(a,t);var e=Object(u["a"])(a);function a(){return Object(n["a"])(this,a),e.apply(this,arguments)}return Object(c["a"])(a,null,[{key:"get",value:function(t){return f["a"].get("ticket",{params:t})}},{key:"create",value:function(t){return f["a"].post("ticket",a.prepareFormData(t))}},{key:"update",value:function(t){return f["a"].post("ticket/"+t.id,a.prepareFormData(Object(s["a"])(Object(s["a"])({},t),{},{_method:"PUT"})))}}]),a}(b["a"]);j.STATE_NEW=0,j.STATE_OPEN=1,j.STATE_WAITING=2,j.STATE_CLOSED=3;var y=function(t){Object(o["a"])(a,t);var e=Object(u["a"])(a);function a(){var t;return Object(n["a"])(this,a),t=e.apply(this,arguments),t.messages=[],t.ticket=null,t.formData={message:""},t}return Object(c["a"])(a,[{key:"disableCheckBtn",get:function(){var t;return[j.STATE_OPEN,j.STATE_CLOSED].includes(null===(t=this.ticket)||void 0===t?void 0:t.status)||!this.messages.length}},{key:"scroll",value:function(){window.scrollTo({top:window.innerHeight,behavior:"smooth"})}},{key:"updateState",value:function(){var t=this;this.formData.message="",m.getList({ticket_user_id:Number(this.$route.params.id),sortType:"desc",sortField:"created_at"}).then((function(e){t.messages=e.data,t.$v.$reset(),t.$nextTick((function(){return t.scroll()}))})),j.get({user_id:Number(this.$route.params.id)}).then((function(e){t.ticket=e.data}))}},{key:"onChecked",value:function(){var t,e=this;j.update({id:null===(t=this.ticket)||void 0===t?void 0:t.id,status:j.STATE_OPEN}).then((function(){e.$router.push({name:"admin.user"})}))}},{key:"onSendMessage",value:function(){var t=this;this.$v.$touch(),this.$v.$invalid?Object(v["e"])(h["a"],this.$store).setData({title:"Заполните сообщение",variant:"danger",direction:1}):m.create(Object(s["a"])({ticket_user_id:Number(this.$route.params.id)},this.formData)).then((function(){Object(v["e"])(h["a"],t.$store).setData({title:"Сообщение успешно отправлено",variant:"success",direction:1}),t.updateState()}))}},{key:"mounted",value:function(){this.updateState()}}]),a}(Object(l["e"])(g["validationMixin"],k["a"]));Object(d["a"])([Object(l["i"])("ps")],y.prototype,"$refPs",void 0),Object(d["a"])([Object(l["i"])("message-container")],y.prototype,"$refMessageContainer",void 0),Object(d["a"])([Object(l["i"])("text-editor")],y.prototype,"$refTextEditor",void 0),y=Object(d["a"])([Object(l["a"])({components:{VueEditor:p["a"]},validations:{formData:{message:{required:O["required"]}}},data:function(){return{customToolbar:[[{header:[!1,2,3,4,5,6]}],["bold","italic","underline","strike"],[{align:""},{align:"center"},{align:"right"},{align:"justify"}],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],["link"],["clean"]]}}})],y);var _=y,T=_,$=(a("4e88"),a("2877")),D=Object($["a"])(T,r,i,!1,null,"2bbf4d94",null);e["default"]=D.exports},caad:function(t,e,a){"use strict";var r=a("23e7"),i=a("4d64").includes,s=a("44d2");r({target:"Array",proto:!0},{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),s("includes")}}]);
//# sourceMappingURL=chunk-1c55e8a0.444fd9db.js.map